(function(e){acf.fields.repeater={o:{},el:".acf-repeater",$field:null,$el:null,$clone:null,set:function(e){this.$field=e;this.$el=e.find(this.el).first();this.$clone=this.$el.find("> table > tbody > tr.clone");this.o=acf.get_data(this.$el);this.o.row_count=this.$el.find("> table > tbody > tr").length-1;return this},init:function(){var e=this.$field;this.o.max!=1&&this.$el.find("> table > tbody").unbind("sortable").sortable({items:"> tr",handle:"> td.order",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){acf.do_action("sortstart",t.item,t.placeholder)},stop:function(t,n){acf.do_action("sortstop",n.item,n.placeholder);acf.fields.repeater.set(e).render()}});this.$clone.find("[name]").attr("disabled","disabled");this.render()},render:function(){this.$el.find("> table > tbody > tr").each(function(t){e(this).children("td.order").html(t+1)});this.o.row_count==0?this.$el.addClass("empty"):this.$el.removeClass("empty");if(this.o.row_count>=this.o.max_rows){this.$el.addClass("disabled");this.$el.find("> .acf-hl .acf-button").addClass("disabled")}else{this.$el.removeClass("disabled");this.$el.find("> .acf-hl .acf-button").removeClass("disabled")}},add:function(t){var n=this.$field;if(this.o.row_count>=this.o.max_rows){alert(acf._e("repeater","max").replace("{max}",this.o.max_rows));return!1}var r=acf.get_uniqid(),i=this.$clone.outerHTML(),i=i.replace(/(="[\w-\[\]]+?)(acfcloneindex)/g,"$1"+r),s=e(i);s.removeClass("clone");s.find("[name]").removeAttr("disabled");t.exists()||(t=this.$clone);t.before(s);this.$field.parents(".acf-row").trigger("mouseenter");this.set(n).render();acf.do_action("append",s);acf.validation.remove_error(this.$field)},remove:function(e){var t=this.$field;if(this.o.row_count<=this.o.max_rows){alert(acf._e("repeater","min").replace("{min}",this.o.min_rows));return!1}acf.remove_tr(e,function(){t.closest(".acf-row").trigger("mouseenter");acf.fields.repeater.set(t).render()})}};acf.add_action("ready append",function(t){acf.get_fields({type:"repeater"},t).each(function(){acf.fields.repeater.set(e(this)).init()})});e(document).on("click",".acf-repeater .acf-repeater-add-row",function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n),i=e();n.is(".acf-icon")&&(i=n.closest(".acf-row"));acf.fields.repeater.set(r).add(i);e(this).blur()});e(document).on("click",".acf-repeater .acf-repeater-remove-row",function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n),i=n.closest(".acf-row");acf.fields.repeater.set(r).remove(i);e(this).blur()});e(document).on("mouseenter",".acf-repeater .acf-row",function(t){var n=e(this).find("> td.remove .acf-repeater-add-row"),r=n.parent().height()/2+9;n.css("margin-top","-"+r+"px")});acf.fields.flexible_content={o:{},el:".acf-flexible-content",$field:null,$el:null,$values:null,$clones:null,set:function(e){this.$field=e;this.$el=e.find(this.el).first();this.$values=this.$el.children(".values");this.$clones=this.$el.children(".clones");this.o=acf.get_data(this.$el);this.o.layout_count=this.$values.children(".layout").length;return this},init:function(){var t=this,n=this.$field;this.o.max!=1&&this.$values.unbind("sortable").sortable({items:"> .layout",handle:"> .acf-fc-layout-handle",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){acf.do_action("sortstart",t.item,t.placeholder)},stop:function(e,r){acf.do_action("sortstop",r.item,r.placeholder);t.set(n).render()}});this.$clones.find("[name]").attr("disabled","disabled");this.render();var r=!1;if(this.o.min>0)r=!0;else{var i=e(this.$el.children(".tmpl-popup").html());i.find("a").each(function(){var t=parseInt(e(this).attr("data-min"));if(t>0){r=!0;return!1}})}r&&this.$field.addClass("required")},render:function(){this.$values.children(".layout").each(function(t){e(this).find("> .acf-fc-layout-handle .fc-layout-order").html(t+1)});this.o.layout_count==0?this.$el.addClass("empty"):this.$el.removeClass("empty");if(this.o.layout_count>=this.o.max){this.$el.addClass("disabled");this.$el.find("> .acf-hl .acf-button").addClass("disabled")}else{this.$el.removeClass("disabled");this.$el.find("> .acf-hl .acf-button").removeClass("disabled")}},validate_add:function(t){var n=!0;this.o.max=parseInt(this.o.max);if(this.o.max>0&&this.o.layout_count>=this.o.max){var r=this.o.max==1?"layout":"layouts",i=acf._e("flexible_content","max");i=i.replace("{max}",this.o.max);i=i.replace("{identifier}",acf._e("flexible_content",r));n=!1;alert(i)}var s=e(this.$el.children(".tmpl-popup").html()),o=s.find('[data-layout="'+t+'"]'),u=o.attr("data-max"),a=this.$values.children('.layout[data-layout="'+t+'"]').length;u=parseInt(u);if(u>0&&a>=u){var r=u==1?"layout":"layouts",i=acf._e("flexible_content","max_layout");i=i.replace("{max}",a);i=i.replace("{label}",'"'+o.text()+'"');i=i.replace("{identifier}",acf._e("flexible_content",r));n=!1;alert(i)}return n},validate_remove:function(t){this.o.min=parseInt(this.o.min);if(this.o.min>0&&this.o.layout_count<=this.o.min){var n=this.o.min==1?"layout":"layouts",r=acf._e("flexible_content","min")+", "+acf._e("flexible_content","remove");r=r.replace("{min}",this.o.min);r=r.replace("{identifier}",acf._e("flexible_content",n));r=r.replace("{layout}",acf._e("flexible_content","layout"));return confirm(r)}var i=e(this.$el.children(".tmpl-popup").html()),s=i.find('[data-layout="'+t+'"]'),o=s.attr("data-min"),u=this.$values.children('.layout[data-layout="'+t+'"]').length;o=parseInt(o);if(o>0&&u<=o){var n=o==1?"layout":"layouts",r=acf._e("flexible_content","min_layout")+", "+acf._e("flexible_content","remove");r=r.replace("{min}",u);r=r.replace("{label}",'"'+s.text()+'"');r=r.replace("{identifier}",acf._e("flexible_content",n));r=r.replace("{layout}",acf._e("flexible_content","layout"));return confirm(r)}return!0},add:function(t,n){if(!this.validate_add(t))return;var r=acf.get_uniqid(),i=this.$clones.children('.layout[data-layout="'+t+'"]').outerHTML(),i=i.replace(/(="[\w-\[\]]+?)(acfcloneindex)/g,"$1"+r),s=e(i);s.find("[name]").removeAttr("disabled");this.$el.children(".no-value-message").hide();n?n.before(s):this.$values.append(s);acf.do_action("append",s);this.render();acf.validation.remove_error(this.$field)},remove:function(e){if(!this.validate_remove(e.attr("data-layout")))return;var t=0,n=this.$el.children(".no-value-message");e.siblings(".layout").length==0&&(t=n.outerHeight());acf.remove_el(e,function(){t>0&&n.show()},t)},toggle:function(e){if(e.attr("data-toggle")=="closed"){e.attr("data-toggle","open");e.children(".acf-input-table").show()}else{e.attr("data-toggle","closed");e.children(".acf-input-table").hide()}},open_popup:function(t,n){var r=this;n=n||!1;var i=e(this.$el.children(".tmpl-popup").html());i.find("a").each(function(){var t=parseInt(e(this).attr("data-min")),n=parseInt(e(this).attr("data-max")),i=e(this).attr("data-layout"),s=e(this).text(),o=r.$values.children('.layout[data-layout="'+i+'"]').length,u=e(this).children(".status");if(n>0){var a=n-o,f=acf.l10n.flexible_content.available,l=a==1?"layout":"layouts",f=f.replace("{available}",a);f=f.replace("{max}",n);f=f.replace("{label}",'"'+s+'"');f=f.replace("{identifier}",acf.l10n.flexible_content[l]);u.show().text(a).attr("title",f);a==0&&u.addClass("warning")}if(t>0){var c=t-o,f=acf.l10n.flexible_content.required,l=c==1?"layout":"layouts",f=f.replace("{required}",c);f=f.replace("{min}",t);f=f.replace("{label}",'"'+s+'"');f=f.replace("{identifier}",acf.l10n.flexible_content[l]);c>0&&u.addClass("warning").show().text(c).attr("title",f)}});t.after(i);if(n){i.addClass("within-layout");i.closest(".layout").addClass("popup-open")}i.css({"margin-top":0-i.height()-t.outerHeight()-14,"margin-left":(t.outerWidth()-i.width())/2});var s=i.offset().top;if(s<30){i.css({"margin-top":15});i.find(".bit").addClass("top")}i.children(".focus").trigger("focus")}};acf.add_action("ready append",function(t){acf.get_fields({type:"flexible_content"},t).each(function(){acf.fields.flexible_content.set(e(this)).init()})});e(document).on("click",".acf-flexible-content .acf-fc-add",function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n),i=!1;e(this).attr("data-before")&&(i=!0);acf.fields.flexible_content.set(r).open_popup(n,i);e(this).blur()});e(document).on("click",".acf-flexible-content .acf-fc-remove",function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n),i=n.closest(".layout");acf.fields.flexible_content.set(r).remove(i);e(this).blur()});e(document).on("click",".acf-flexible-content .acf-fc-layout-handle",function(t){t.preventDefault();var n=e(this),r=n.closest(".layout");acf.fields.flexible_content.toggle(r);e(this).blur()});e(document).on("click",".acf-flexible-content .acf-fc-popup li a",function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n),i=n.closest(".acf-fc-popup");$layout=null;i.hasClass("within-layout")&&($layout=i.closest(".layout"));acf.fields.flexible_content.set(r).add(n.attr("data-layout"),$layout);e(this).blur()});e(document).on("blur",".acf-flexible-content .acf-fc-popup .focus",function(t){var n=e(this).parent();n.closest(".layout").exists()&&n.closest(".layout").removeClass("popup-open");setTimeout(function(){n.remove()},200)});e(document).on("acf/validate_field",function(t,n){var r=e(n);if(!r.hasClass("field_type-flexible_content"))return;var i=r.find(".acf-flexible-content:first");r.data("validation",!1);r.data("validation_message",!1);i.children(".values").children(".layout").exists()&&r.data("validation",!0);var s=parseInt(i.attr("data-min"));if(s>0&&i.children(".values").children(".layout").length<s){var o=s==1?"layout":"layouts",u=acf.l10n.flexible_content.min;u=u.replace("{min}",s);u=u.replace("{identifier}",acf.l10n.flexible_content[o]);r.data("validation",!1);r.data("validation_message",u)}var a=e(i.children(".tmpl-popup").html());a.find("a").each(function(){var t=parseInt(e(this).attr("data-min")),n=parseInt(e(this).attr("data-max")),s=e(this).attr("data-layout"),o=e(this).text(),u=i.children(".values").children('.layout[data-layout="'+s+'"]').length;if(u<t){var a=t==1?"layout":"layouts",f=acf.l10n.flexible_content.min_layout;f=f.replace("{min}",t);f=f.replace("{label}",'"'+o+'"');f=f.replace("{identifier}",acf.l10n.flexible_content[a]);r.data("validation",!1);r.data("validation_message",f)}})});acf.fields.gallery={o:{},el:".acf-gallery",$field:null,$el:null,set:function(e){this.$field=e;this.$el=e.find(this.el).first();this.o=acf.get_data(this.$el);return this},count:function(){return this.$el.find(".acf-gallery-attachment").length},init:function(){this.$el.find(".acf-gallery-attachments").unbind("sortable").sortable({items:".acf-gallery-attachment",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){acf.do_action("sortstart",t.item,t.placeholder)},stop:function(e,t){acf.do_action("sortstop",t.item,t.placeholder)}});this.render()},render:function(){var e=this.$el.find('[data-name="bulk-actions-select"]'),t=this.$el.find('[data-name="add-attachment-button"]');this.count()>0?e.removeAttr("disabled"):e.attr("disabled","disabled");this.count()>=this.o.max?t.addClass("disabled"):t.removeClass("disabled")},sort:function(t){var n=this.$el;if(!t)return;var r={action:"acf/fields/gallery/get_sort_order",field_key:acf.get_data(this.$field,"key"),nonce:acf.get("nonce"),post_id:acf.get("post_id"),ids:[],sort:t};n.find(".acf-gallery-attachment").each(function(){r.ids.push(e(this).attr("data-id"))});var i=e.ajax({url:acf.get("ajaxurl"),dataType:"json",type:"get",cache:!1,data:r,success:function(e){if(!e.success)return;e.data.reverse();_.each(e.data,function(e){var t=n.find('.acf-gallery-attachment[data-id="'+e+'"]');n.find(".acf-gallery-attachments").prepend(t)})}})},clear_selection:function(e){this.$el.find(".acf-gallery-attachment.active").removeClass("active")},select:function(e){var t=e.attr("data-id");this.clear_selection();e.addClass("active");this.fetch(t);this.open_sidebar()},open_sidebar:function(){this.$el.find(".acf-gallery-main").animate({right:300},250);this.$el.find(".acf-gallery-side").animate({width:299},250)},close_sidebar:function(){this.clear_selection();this.$el.find(".acf-gallery-main").animate({right:0},250);this.$el.find(".acf-gallery-side").animate({width:0},250,function(){e(this).find(".acf-gallery-side-data").html("")})},fetch:function(t){var n=this.$el,r={action:"acf/fields/gallery/get_attachment",field_key:acf.get_data(this.$field,"key"),nonce:acf.get("nonce"),post_id:acf.get("post_id"),id:t};n.data("xhr")&&n.data("xhr").abort();var i=e.ajax({url:acf.get("ajaxurl"),dataType:"html",type:"get",cache:!1,data:r,success:function(e){n.find(".acf-gallery-side-data").html(e)}});n.data("xhr",i)},save:function(){var t=this.$el.find('[data-name="save-attachment-button"]');$form=this.$el.find(".acf-gallery-side-data"),data=acf.serialize_form($form);if(t.attr("disabled"))return!1;t.attr("disabled","disabled");t.before('<i class="acf-loading"></i>');data.action="acf/fields/gallery/update_attachment";data.nonce=acf.get("nonce");e.ajax({url:acf.get("ajaxurl"),data:data,type:"post",dataType:"json",success:function(e){t.removeAttr("disabled");t.prev(".acf-loading").remove()}})},add:function(e){if(this.count()>=this.o.max){acf.validation.add_warning(this.$field,acf._e("gallery","max"));return!1}e.name=this.$el.find('[data-name="ids"]').attr("name");var t=acf._e("gallery","tmpl"),n=_.template(t,e);this.$el.find(".acf-gallery-attachments").append(n);this.render()},remove:function(e){this.clear_selection();this.$el.find(".acf-gallery-side-data").html("");this.$el.find('.acf-gallery-attachment[data-id="'+e+'"]').remove();this.count()==0&&this.close_sidebar();this.render()},render_collection:function(e,t){setTimeout(function(){var n=e.content.get().$el;collection=e.content.get().collection||null;if(collection){var r=-1;collection.each(function(e){r++;var s=n.find(".attachments > .attachment:eq("+r+")");if(t.find('.acf-gallery-attachment[data-id="'+e.id+'"]').exists()){e.off("selection:single");s.addClass("acf-selected")}})}},10)},popup:function(){if(this.count()>=this.o.max){acf.validation.add_warning(this.$field,acf._e("gallery","max"));return!1}var e=this.o.library,t=this.o.preview_size,n=this.$field,r=this.$el,i=acf.media.upload_popup({title:acf._e("gallery","select"),type:"image",multiple:1,uploadedTo:e=="uploadedTo"?acf.get("post_id"):0,activate:function(e){acf.fields.gallery.render_collection(e,r);e.content.get().collection.on("reset add",function(){acf.fields.gallery.render_collection(e,r)})},select:function(e,i){if(r.find('.acf-gallery-attachment[data-id="'+e.id+'"]').exists())return;var s={id:e.id,url:e.attributes.url};e.attributes.type!="image"&&(s.url=e.attributes.icon);e.attributes.sizes&&e.attributes.sizes[t]&&(s.url=e.attributes.sizes[t].url);acf.fields.gallery.set(n).add(s)}})}};acf.add_action("ready append",function(t){acf.get_fields({type:"gallery"},t).each(function(){acf.fields.gallery.set(e(this)).init()})});e(document).on("click",".acf-gallery .acf-gallery-attachment",function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n);acf.fields.gallery.set(r).select(n)});e(document).on("click",'.acf-gallery [data-name="close-attachment-button"]',function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n);acf.fields.gallery.set(r).close_sidebar()});e(document).on("click",'.acf-gallery [data-name="save-attachment-button"]',function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n);acf.fields.gallery.set(r).save()});e(document).on("click",'.acf-gallery [data-name="remove-attachment-button"]',function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n);acf.fields.gallery.set(r).remove(n.attr("data-id"))});e(document).on("click",'.acf-gallery [data-name="add-attachment-button"]',function(t){t.preventDefault();var n=e(this),r=acf.get_field_wrap(n);acf.fields.gallery.set(r).popup()});e(document).on("change",'.acf-gallery [data-name="bulk-actions-select"]',function(t){var n=e(this),r=acf.get_field_wrap(n);if(!n.val())return!1;acf.fields.gallery.set(r).sort(n.val());e(this).val("")})})(jQuery);