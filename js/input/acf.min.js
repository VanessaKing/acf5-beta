/*
*  input.js
*
*  All javascript needed for ACF to work
*
*  @type	awesome
*  @date	1/08/13
*
*  @param	N/A
*  @return	N/A
*/var acf={l10n:{},o:{},get:null,update:null,_e:null,get_atts:null,get_fields:null,get_uniqid:null,serialize_form:null,add_action:null,remove_action:null,do_action:null,add_filter:null,remove_filtern:null,apply_filters:null,helpers:{is_clone_field:null},validation:null,conditional_logic:null,media:null,fields:{date_picker:null,color_picker:null,image:null,file:null,wysiwyg:null,gallery:null,relationship:null}};(function(e){e.extend(acf,{update:function(e,t){this.o[e]=t},get:function(e){return this.o[e]||null},_e:function(e,t){t=t||!1;var n=this.l10n[e]||!1;t&&(n=n[t]||!1);return n||""},get_atts:function(t){var n={};t.exists()&&e.each(t[0].attributes,function(t,r){if(r.name.substr(0,5)=="data-"){var i=r.value,s=r.name.replace("data-","");e.isNumeric(i)&&(i=parseInt(i));n[s]=i}});return n},get_fields:function(t,n,r){t=t||{};n=n||e("body");r=r||!0;var i=".acf-field";e.each(t,function(e,t){i+="[data-"+e+'="'+t+'"]'});var s=n.find(i);r&&(s=s.filter(function(){return acf.apply_filters("is_field_ready_for_js",!0,e(this))}));return s},get_field:function(t,n){n=n||e("body");$fields=this.get_fields({key:t},n);return $fields.exists()?$fields.first():!1},get_field_wrap:function(e){return e.closest(".acf-field")},get_field_data:function(e,t){return e.attr("data-"+t)},is_field:function(t,n){var r=!0;t.hasClass("acf-field")||(r=!1);e.each(n,function(e,n){t.attr("data-"+e)!=n&&(r=!1)});return r},get_uniqid:function(e,t){typeof e=="undefined"&&(e="");var n,r=function(e,t){e=parseInt(e,10).toString(16);return t<e.length?e.slice(e.length-t):t>e.length?Array(1+(t-e.length)).join("0")+e:e};this.php_js||(this.php_js={});this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(Math.random()*123456789));this.php_js.uniqidSeed++;n=e;n+=r(parseInt((new Date).getTime()/1e3,10),8);n+=r(this.php_js.uniqidSeed,5);t&&(n+=(Math.random()*10).toFixed(8).toString());return n},serialize_form:function(t){var n={},r={};$selector=t.find("select, textarea, input");e.each($selector.serializeArray(),function(e,t){if(t.name.slice(-2)==="[]"){t.name=t.name.replace("[]","");typeof r[t.name]=="undefined"&&(r[t.name]=-1);r[t.name]++;t.name+="["+r[t.name]+"]"}n[t.name]=t.value});return n},remove_tr:function(e,t){var n=e.height(),r=e.children().length;e.addClass("acf-remove-element");setTimeout(function(){e.removeClass("acf-remove-element");e.html('<td style="padding:0; height:'+n+'px" colspan="'+r+'"></td>');e.children("td").animate({height:0},250,function(){e.remove();typeof t=="function"&&t()})},250)},remove_el:function(t,n){t.css({height:t.height(),width:t.width(),position:"absolute",padding:0});t.wrap('<div class="acf-temp-wrap" style="height:'+t.outerHeight(!0)+'px"></div>');t.animate({opacity:0},250);t.parent(".acf-temp-wrap").animate({height:0},250,function(){e(this).remove();typeof n=="function"&&n()})},isset_object:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();for(var n=0;n<e.length;n++){if(!t.hasOwnProperty(e[n]))return!1;t=t[e[n]]}return!0},open_popup:function(t){$popup=e("body > #acf-poup");if($popup.exists())return update_popup(t);var n=['<div id="acf-popup">','<div class="acf-popup-box acf-box">','<div class="title"><h3></h3><a href="#" class="acf-icon"><i class="acf-sprite-delete "></i></a></div>','<div class="inner"></div>','<div class="loading"><i class="acf-loading"></i></div>',"</div>",'<div class="bg"></div>',"</div>"].join("");e("body").append(n);e("#acf-popup .bg, #acf-popup .acf-icon").on("click",function(){acf.close_popup()});return this.update_popup(t)},update_popup:function(t){$popup=e("#acf-popup");if(!$popup.exists())return!1;t=e.extend({},{title:"",content:"",width:0,height:0,loading:!1},t);t.width&&$popup.find(".acf-popup-box").css({width:t.width,"margin-left":0-t.width/2});t.height&&$popup.find(".acf-popup-box").css({height:t.height,"margin-top":0-t.height/2});t.title&&$popup.find(".title h3").html(t.title);t.content&&$popup.find(".inner").html(t.content);t.loading?$popup.find(".loading").show():$popup.find(".loading").hide();return $popup},close_popup:function(){$popup=e("#acf-popup");$popup.exists()&&$popup.remove()}});e.extend(acf,{add_action:function(){var e=arguments[0].split(" ");for(k in e){arguments[0]="acf."+e[k];wp.hooks.addAction.apply(this,arguments)}return this},remove_action:function(){arguments[0]="acf."+arguments[0];wp.hooks.removeAction.apply(this,arguments);return this},do_action:function(){arguments[0]="acf."+arguments[0];wp.hooks.doAction.apply(this,arguments);return this},add_filter:function(){arguments[0]="acf."+arguments[0];wp.hooks.addFilter.apply(this,arguments);return this},remove_filter:function(){arguments[0]="acf."+arguments[0];wp.hooks.removeFilter.apply(this,arguments);return this},apply_filters:function(){arguments[0]="acf."+arguments[0];return wp.hooks.applyFilters.apply(this,arguments)}});acf.add_filter("is_field_ready_for_js",function(e,t){t.parents('.acf-row[data-id="acfcloneindex"]').exists()&&(e=!1);t.parents("#available-widgets").exists()&&(e=!1);return e});acf.helpers.is_clone_field=function(e){return e.attr("name")&&e.attr("name").indexOf("[acfcloneindex]")!=-1?!0:!1};e.fn.exists=function(){return e(this).length>0};e.fn.outerHTML=function(){return e(this).clone().wrap("<div>").parent().html()};acf.media={upload_popup:function(t){t=e.extend({},{title:"",type:"",query:{},uploadedTo:0,multiple:0,activate:function(){},select:function(e,t){}},t);t.type&&(t.query={type:t.type});var n=wp.media({states:[new wp.media.controller.Library({title:t.title,multiple:t.multiple,library:wp.media.query(t.query),priority:20,filterable:"all"})]});n.on("content:activate",function(){var r=null,i=null;try{r=n.content.get().toolbar;i=r.get("filters")}catch(s){}if(!i)return!1;if(t.uploadedTo){i.$el.find('option[value="uploaded"]').remove();i.$el.after("<span>"+acf._e("image","uploadedTo")+"</span>");e.each(i.filters,function(e,n){n.props.uploadedTo=t.uploadedTo})}if(t.type=="image"){e.each(i.filters,function(e,t){t.props.type="image"});i.$el.find("option").each(function(){var n=e(this).attr("value");if(n=="uploaded"&&!t.uploadedTo)return;n.indexOf("image")===-1&&e(this).remove()});i.$el.val("image").trigger("change")}typeof t.activate=="function"&&t.activate.apply(this,[n])});n.on("select",function(){if(typeof t.select!="function")return!1;var e=n.state().get("selection");if(e){var r=-1;e.each(function(e){r++;t.select.apply(this,e,r)})}});n.on("close",function(){setTimeout(function(){n.detach();n.dispose();n=null},500)});n.open();return n},edit_popup:function(t){t=e.extend({},{title:"",button:"",id:0},t);var n=wp.media({title:t.title,multiple:0,button:{text:t.button}});n.on("open",function(){n.content._mode!="browse"&&n.content.mode("browse");n.$el.closest(".media-modal").addClass("acf-media-modal acf-expanded");var r=n.state().get("selection"),i=wp.media.attachment(t.id);e.isEmptyObject(i.changed)&&i.fetch();r.add(i)});n.on("select",function(){if(typeof t.select!="function")return!1;var e=n.state().get("selection");if(e){var r=-1;e.each(function(e){r++;t.select(e,r)})}});n.on("close",function(){setTimeout(function(){n.detach();n.dispose();n=null},500);n.$el.closest(".media-modal").removeClass("acf-media-modal")});n.open();return n},init:function(){if(typeof wp.media=="undefined")return!1;var t=wp.media.view.AttachmentCompat.prototype;t.orig_render=t.render;t.orig_dispose=t.dispose;t.className="compat-item acf_postbox no_box";t.render=function(){var t=this;if(t.ignore_render)return this;this.orig_render();setTimeout(function(){var n=t.$el.closest(".media-modal");if(n.hasClass("acf-media-modal"))return;if(n.find(".media-frame-router .acf-expand-details").exists())return;var r=e(['<a href="#" class="acf-expand-details">','<span class="icon"></span>','<span class="is-closed">'+acf.l10n.core.expand_details+"</span>",'<span class="is-open">'+acf.l10n.core.collapse_details+"</span>","</a>"].join(""));r.on("click",function(e){e.preventDefault();n.hasClass("acf-expanded")?n.removeClass("acf-expanded"):n.addClass("acf-expanded")});n.find(".media-frame-router").append(r)},0);clearTimeout(acf.media.render_timout);acf.media.render_timout=setTimeout(function(){e(document).trigger("acf/setup_fields",[t.$el])},50);return this};t.dispose=function(){e(document).trigger("acf/remove_fields",[this.$el]);this.orig_dispose()};t.save=function(e){var t={},n={};e&&e.preventDefault();_.each(this.$el.serializeArray(),function(e){if(e.name.slice(-2)==="[]"){e.name=e.name.replace("[]","");typeof n[e.name]=="undefined"&&(n[e.name]=-1);n[e.name]++;e.name+="["+n[e.name]+"]"}t[e.name]=e.value});this.ignore_render=!0;this.model.saveCompat(t)}}};acf.conditional_logic={items:[],init:function(){var t=this;e(document).on("change",".acf-field input, .acf-field textarea, .acf-field select",function(){e("#acf-has-changed").exists()&&e("#acf-has-changed").val(1);t.change(e(this))});acf.add_action("ready",function(n){t.refresh(e(el))});t.refresh()},change:function(t){var n=this,r=acf.get_field_wrap(t),i=acf.get_field_data(r,"key");e.each(this.items,function(t,r){e.each(r.rules,function(e,t){t.field==i&&n.refresh_field(r)})})},refresh_field:function(t){var n=this,r=acf.get_fields({key:t.field});r.each(function(){var r=!0;t.allorany=="any"&&(r=!1);var i=e(this),s=!0;e.each(t.rules,function(o,u){var a=acf.get_fields({key:u.field});if(a.hasClass("sub_field")){a=i.siblings(".field_key-"+u.field);s=!1;if(!a.exists()){i.parents("tr").each(function(){a=e(this).find(".field_key-"+u.field);if(a.exists())return!1});s=!0}}var f=i.parent("tr").parent().parent("table").parent(".layout");if(f.exists()){s=!0;i.is("th")&&a.is("th")&&(a=i.closest(".layout").find("td.field_key-"+u.field))}var f=i.parent("tr").parent().parent("table").parent(".repeater");if(f.exists()&&f.attr("data-max_rows")=="1"){s=!0;i.is("th")&&a.is("th")&&(a=i.closest("table").find("td.field_key-"+u.field))}var l=n.calculate(u,a,i);if(t.allorany=="all"){if(l==0){r=!1;return!1}}else if(l==1){r=!0;return!1}});i.removeClass("acf-conditional_logic-hide acf-conditional_logic-show acf-show-blank");if(r){i.find("input, textarea, select").removeAttr("disabled");i.addClass("acf-conditional_logic-show");e(document).trigger("acf/conditional_logic/show",[i,t])}else{i.find("input, textarea, select").attr("disabled","disabled");i.addClass("acf-conditional_logic-hide");s||i.addClass("acf-show-blank");e(document).trigger("acf/conditional_logic/hide",[i,t])}})},refresh:function(t){t=t||e("body");var n=this;e.each(this.items,function(r,i){e.each(i.rules,function(e,r){if(!t.find('.field[data-field_key="'+i.field+'"]').exists())return;n.refresh_field(i)})})},calculate:function(t,n,r){var i=!1;if(n.hasClass("field_type-true_false")||n.hasClass("field_type-checkbox")||n.hasClass("field_type-radio")){var s=n.find('input[value="'+t.value+'"]:checked').exists();t.operator=="=="?s&&(i=!0):s||(i=!0)}else{var o=n.find("input, textarea, select").last().val();e.isArray(o)||(o=[o]);t.operator=="=="?e.inArray(t.value,o)>-1&&(i=!0):e.inArray(t.value,o)<0&&(i=!0)}return i}};e(document).ready(function(){acf.do_action("ready",e("body"))});e(window).load(function(){acf.do_action("load",e("body"));acf.media.init();setTimeout(function(){try{e.isNumeric(acf.o.post_id)&&(wp.media.view.settings.post.id=acf.o.post_id)}catch(t){}},10)});acf.add_action("sortstart",function(t,n){if(t.is("tr")){t.css("position","relative");t.children().each(function(){e(this).width(e(this).width())});t.css("position","absolute");n.html('<td style="height:'+t.height()+'px; padding:0;" colspan="'+t.children("td").length+'"></td>')}})})(jQuery);