/*
*  field-group.js
*
*  All javascript needed to create a field group
*
*  @type	JS
*  @date	1/08/13
*/var acf={l10n:null,o:null,helpers:{uniqid:null,sortable:null,render_field:null},fields:null,conditional_logic:null,location:null,options:null};(function(e){e.fn.exists=function(){return e(this).length>0};acf.helpers.sortable=function(t,n){n.children().each(function(){e(this).width(e(this).width())});return n};acf.helpers.uniqid=function(e,t){typeof e=="undefined"&&(e="");var n,r=function(e,t){e=parseInt(e,10).toString(16);return t<e.length?e.slice(e.length-t):t>e.length?Array(1+(t-e.length)).join("0")+e:e};this.php_js||(this.php_js={});this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(Math.random()*123456789));this.php_js.uniqidSeed++;n=e;n+=r(parseInt((new Date).getTime()/1e3,10),8);n+=r(this.php_js.uniqidSeed,5);t&&(n+=(Math.random()*10).toFixed(8).toString());return n};e(document).on("submit","#post",function(){var t=e("#titlewrap #title");if(!t.val()){alert(acf.l10n.title);t.focus();return!1}});e(document).on("click","#submit-delete",function(){var e=confirm(acf.l10n.move_to_trash);if(!e)return!1});e(document).on("ready",function(){e("#submitdiv, #acf-field-group-fields, #acf-field-group-locations, #acf-field-group-options").addClass("acf-postbox settings");e("#submitdiv #publish").attr("class","acf-button blue large");e("#submitdiv a.submitdelete").attr("class","delete-field-group").attr("id","submit-delete");acf.fields.init();acf.location.init();acf.conditional_logic.init();acf.options.init()});acf.fields={$el:null,init:function(){var t=this;this.$el=e("#acf-field-group-fields");this.$el.find("> .inside > .acf-field-list").sortable({update:function(e,n){t.render()},handle:".acf-icon"});this.$el.on("click",".edit-field",function(n){n.preventDefault();t.edit(e(this).closest(".field"))});this.$el.on("click",".delete-field",function(n){n.preventDefault();t.remove(e(this).closest(".field"))});this.$el.on("click","#add-field",function(e){e.preventDefault();t.add()});this.$el.on("change",".field-type-select",function(){t.change_type(e(this))});this.$el.on("change",".field-label-input",function(n){n.preventDefault();t.change_label(e(this).closest(".field"))})},edit:function(t){if(t.hasClass("open")){t.removeClass("open");e(document).trigger("acf/field_group/close_field",[t])}else{t.addClass("open");e(document).trigger("acf/field_group/open_field",[t])}t.find("> .acf-hidden > .input-changed").val(1);t.children(".field-options").animate({height:"toggle"},250)},change_type:function(t){var n=t.closest("tbody"),r=n.closest(".field"),i=r.attr("data-type"),s=t.val();r.removeClass("field_type-"+i).addClass("field_type-"+s).attr("data-type",s);(s=="tab"||s=="message")&&n.find('tr[data-name="name"] input').val("").trigger("keyup");n.children("tr[data-option]").hide().find("[name]").attr("disabled","true");if(n.children('tr[data-option="'+s+'"]').exists())n.children('tr[data-option="'+s+'"]').show().find("[name]").removeAttr("disabled");else{var o=e('<tr class="acf-field"><td class="acf-label"></td><td class="acf-input"><div class="acf-loading"></div></td></tr>');n.children(".field_save").before(o);var u={action:"acf/field_group/render_field_options",nonce:acf.o.nonce,post_id:acf.o.post_id,prefix:t.attr("name").replace("[type]",""),type:s};e.ajax({url:acf.o.ajaxurl,data:u,type:"post",dataType:"html",success:function(e){if(!e){o.remove();return}o.replaceWith(e)}})}},add:function(){var e=this.$el.find("> .inside > .acf-field-list"),t=e.children('.field[data-key="field_clone"]').clone();this.wipe_field(t);t.show();e.children('.field[data-key="field_clone"]').before(t);e.children(".no-fields-message").hide();t.find(".field-options .tr-field-type:first select").trigger("change");t.find('.field-options input[type="text"]').val("");setTimeout(function(){t.find('.field_form input[type="text"]:first').focus()},251);this.render();this.edit(t)},remove:function(t){var n=this,r=t.attr("data-ID");r&&e("#input-delete-fields").val(e("#input-delete-fields").val()+"|"+r);var i=t.closest(".acf-field-list");t.css({height:t.height(),width:t.width(),position:"absolute"});t.wrap('<div class="temp-field-wrap" style="height:'+t.height()+'px"></div>');t.animate({opacity:0},250);var s=0;i.children(".field").length==1&&(s=i.children(".no-fields-message").height());t.parent(".temp-field-wrap").animate({height:s},250,function(){e(this).remove();n.render()})},move:function(){},duplicate:function(){},wipe_field:function(t){var n=t.attr("data-id"),r=acf.helpers.uniqid("field_");t.attr("data-key",r);t.attr("data-id","");t.find("> .acf-hidden > .input-ID").val("");t.find("> .acf-hidden > .input-key").val(r);t.attr("class",t.attr("class").replace(n,r));t.find('[id*="'+n+'"]').each(function(){e(this).attr("id",e(this).attr("id").replace(n,r))});t.find('[name*="'+n+'"]').each(function(){e(this).attr("name",e(this).attr("name").replace(n,r))})},render:function(){this.$el.find(".acf-field-list").each(function(){e(this).children(".field").each(function(t){e(this).find(".li-field_order:first .acf-icon").html(t+1);e(this).find("> .acf-hidden > .input-menu_order").val(t)})})},change_label:function(t){var n=t.find('tr[data-name="label"] input'),r=t.find('tr[data-name="name"] input'),i=t.attr("data-type");if(i=="tab"||i=="message"){r.val("").trigger("change");return}if(r.val()==""){var s=n.val(),o={"ä":"a","æ":"a","å":"a","ö":"o","ø":"o","é":"e","ë":"e","ü":"u","ó":"o","ő":"o","ú":"u","é":"e","á":"a","ű":"u","í":"i"," ":"_","'":""};e.each(o,function(e,t){var n=new RegExp(e,"g");s=s.replace(n,t)});s=s.toLowerCase();r.val(s).trigger("change")}}};acf.options={$el:null,init:function(){this.$el=e("#acf-field-group-options");var t=this.$el.find(".tr-hide-on-screen ul.acf-checkbox-list"),n=e('<li><label><input type="checkbox" value="" name="" >'+acf.l10n.hide_show_all+"</label></li>");t.find("input:not(:checked)").length==0&&n.find("input").attr("checked","checked");n.on("change","input",function(){var n=e(this).is(":checked");t.find("input").attr("checked",n)});t.prepend(n)}};acf.location={$el:null,init:function(){var t=this;t.$el=e("#acf-field-group-locations");t.$el.on("click",".location-add-rule",function(n){n.preventDefault();t.add_rule(e(this).closest("tr"))});t.$el.on("click",".location-remove-rule",function(n){n.preventDefault();t.remove_rule(e(this).closest("tr"))});t.$el.on("click",".location-add-group",function(e){e.preventDefault();t.add_group()});t.$el.on("change",".param select",function(){var t=e(this).closest("tr"),n=t.attr("data-id"),r=t.closest(".location-group"),i=r.attr("data-id"),s={action:"acf/field_group/render_location_value",nonce:acf.o.nonce,rule_id:n,group_id:i,value:"",param:e(this).val()},o=e('<div class="acf-loading"></div>');t.find("td.value").html(o);e.ajax({url:acf.o.ajaxurl,data:s,type:"post",dataType:"html",success:function(e){o.replaceWith(e)}})})},add_rule:function(t){var n=t.clone(),r=n.attr("data-id"),i=acf.helpers.uniqid();n.find("[name]").each(function(){e(this).attr("name",e(this).attr("name").replace(r,i));e(this).attr("id",e(this).attr("id").replace(r,i))});n.attr("data-id",i);t.after(n);return!1},remove_rule:function(e){var t=e.siblings("tr").length;t==0?this.remove_group(e.closest(".location-group")):e.remove()},add_group:function(){var t=this.$el.find(".location-group:last"),n=t.clone(),r=n.attr("data-id"),i=acf.helpers.uniqid();n.find("[name]").each(function(){e(this).attr("name",e(this).attr("name").replace(r,i));e(this).attr("id",e(this).attr("id").replace(r,i))});n.attr("data-id",i);n.find("h4").text(acf.l10n.or);n.find("tr:not(:first)").remove();t.after(n)},remove_group:function(e){e.remove()}};acf.helpers.render_field=function(t){var n={type:"text",classname:"",name:"",value:""};t=e.extend(!0,n,t);var r="";if(t.type=="text")r+='<input class="text '+t.classname+'" type="text" id="'+t.name+'" name="'+t.name+'" value="'+t.value+'" />';else if(t.type=="select"){var i={};e.each(t.choices,function(e,t){t.group===undefined&&(t.group=0);i[t.group]===undefined&&(i[t.group]=[]);i[t.group].push(t)});r+='<select class="select '+t.classname+'" id="'+t.name+'" name="'+t.name+'">';e.each(i,function(n,i){n!=0&&(r+='<optgroup label="'+n+'">');e.each(i,function(e,n){var i="";n.value==t.value&&(i='selected="selected"');r+="<option "+i+' value="'+n.value+'">'+n.label+"</option>"});n!=0&&(r+="</optgroup>")});r+="</select>"}r=e(r);return r};acf.conditional_logic={triggers:null,init:function(){var t=this;e(document).on("acf/field_form-open",function(e,n){t.sync();t.render(n)});e(document).on("change",'tr.conditional-logic input[type="radio"]',function(n){n.preventDefault();t.change_toggle(e(this))});e(document).on("change","select.conditional-logic-field",function(n){n.preventDefault();t.change_trigger(e(this))});e(document).on("click","tr.conditional-logic .acf-button-add",function(n){n.preventDefault();t.add(e(this).closest("tr"))});e(document).on("click","tr.conditional-logic .acf-button-remove",function(n){n.preventDefault();t.remove(e(this).closest("tr"))})},sync:function(){var t=this;this.triggers={0:[]};e("#acf_fields .field").each(function(){var n=e(this),r=n.attr("data-id"),i=n.attr("data-type"),s=n.find("tr.field_label input").val(),o=0;if(r=="field_clone")return;var u=n.parent().closest(".field");if(u.exists()){o=u.attr("data-id");t.triggers[o]===undefined&&(t.triggers[o]=[])}(i=="select"||i=="checkbox"||i=="true_false"||i=="radio")&&t.triggers[o].push({id:r,type:i,label:s})})},render:function(t){var n=this,r=[],i=t.parent().parents(".field"),s=t.find("> .field_form_mask > .field_form > table > tbody > tr.conditional-logic");e.each(this.triggers[0],function(e,t){r.push({value:t.id,label:t.label})});if(i.exists()){e.each(r,function(e,t){r[e].group=acf.l10n.fields});i.each(function(t){var i=e(this).attr("data-id"),s=t==0?acf.l10n.sibling_fields:acf.l10n.parent_fields;e.each(n.triggers[i],function(e,t){r.push({value:t.id,label:t.label,group:s})})})}r.length==0&&r.push({value:"null",label:acf.l10n.no_fields});s.find(".conditional-logic-field").each(function(){var t=e(this).val(),n=e(this).attr("name"),i=acf.helpers.render_field({type:"select",classname:"conditional-logic-field",name:n,value:t,choices:r});e(this).replaceWith(i);i.trigger("change")})},change_toggle:function(e){var t=e.val(),n=e.closest("tr.conditional-logic");t=="1"?n.find(".contional-logic-rules-wrapper").show():n.find(".contional-logic-rules-wrapper").hide()},change_trigger:function(t){var n=t.val(),r=e(".field_key-"+n),i=r.attr("data-type"),s=t.closest("tr").find(".conditional-logic-value"),o=[];if(i=="true_false")o=[{value:1,label:acf.l10n.checked}];else if(i=="select"||i=="checkbox"||i=="radio"){var u=r.find(".field_option-choices").val().split("\n");if(u)for(var a=0;a<u.length;a++){var f=u[a].split(":"),l=f[0];f[1]&&(l=f[1]);o.push({value:e.trim(f[0]),label:e.trim(l)})}}var t=acf.helpers.render_field({type:"select",classname:"conditional-logic-value",name:s.attr("name"),value:s.val(),choices:o});s.replaceWith(t);t.trigger("change")},add:function(t){var n=t.clone(),r=parseFloat(t.attr("data-i")),i=r+1;n.find("[name]").each(function(){e(this).attr("name",e(this).attr("name").replace("["+r+"]","["+i+"]"));e(this).attr("id",e(this).attr("id").replace("["+r+"]","["+i+"]"))});n.attr("data-i",i);t.after(n);t.closest("table").removeClass("remove-disabled")},remove:function(e){var t=e.closest("table");if(t.hasClass("remove-disabled"))return!1;e.remove();t.find("tr").length<=1&&t.addClass("remove-disabled")}};e(document).on("change",".radio-option-other_choice input",function(){var t=e(this),n=t.closest("td");if(t.is(":checked"))n.find(".radio-option-save_other_choice").show();else{n.find(".radio-option-save_other_choice").hide();n.find(".radio-option-save_other_choice input").removeAttr("checked")}})})(jQuery);